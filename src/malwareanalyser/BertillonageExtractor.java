package malwareanalyser;

import java.io.File;
import java.io.IOException;

import org.apache.bcel.Repository;
import org.apache.bcel.classfile.*;
import org.apache.bcel.generic.ClassGen;

public class BertillonageExtractor {
	public static void main(String[] args) throws IOException {

		try {
			String fileName = "/Users/msgeden/Desktop/Data_MB_SMALL/Factorial.class";
			String newFileName = "/Users/msgeden/Desktop/Data_MB_SMALL/NewFactorial.class";
			File newFile = new File(newFileName);
			ClassParser parser = new ClassParser(fileName);
			// JavaClass clazz = Repository.lookupClass("java.lang.String");
			JavaClass clazz = parser.parse();
			System.out.println(clazz);
			// clazz.setConstantPool(null);
			ClassGen cg = new ClassGen(clazz);
			cg.getJavaClass().dump(newFile);
			printCode(clazz.getMethods());
		} catch (Exception e) {
			// TODO Auto-generated catch block
			e.printStackTrace();
		}
	}

	public static void printCode(Method[] methods) {
		for (int i = 0; i < methods.length; i++) {
			System.out.println(methods[i]);

			Code code = methods[i].getCode();
			ConstantPool pool = methods[i].getConstantPool();
			if (code != null) // Non-abstract method
				System.out.println(code);

			byte[] array = code.getCode();
			System.out.print(array.toString());
		}
	}

}
